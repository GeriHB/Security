# Server-Side Template Injection

Is when an attacker can use native template syntax to inject a malicious payload into a template, which is then executed server-side.

Template engines are designed to generate web pages by combining fixed templates with volatile data, and injection attacks occur when user input is concatenated directly into a template, rather than passed in as data.

This allows attackers to put directives in order to manipulate the template engine, which often enables them to take complete control of the server.

## How do these vulnerabilities arise?

Static templates that simply provide placeholders into which dynamic content is rendered are generally not vulnerable.

An example is an email that greets users by their name, as this extract from a Twig template:

`$output = $twig->render("Dear {first_name},", array("first_name" => $user.first_name) );`

This is not vulnerable because the first name is passed into the template as data.

But, since templates are simply strings, web devs sometimes directly concatenate user input into templates prior to rendering.

A similar example is when users are able to customize parts of the email before it's sent, like choosing the name that is used:

`$output = $twig->render("Dear " . $_GET['name']);`

Here, instead of a static value, part of the template itself is being dynamically generated using the `GET` parameter `name`. 

The template syntax is evaluated server-side, and this can allow an attacker to place a payload in the name parameter.

Sometimes this behavior is done intentionally, as some websites allow privileged users, to edit or submit custom templates by design.

## Constructing an attack

To perform an attack, the following steps should be taken:

- Detect
- Identify
- Exploit
	- Read
	- Explore
	- Attack