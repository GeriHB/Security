Some websites implement functions over a series of steps, for example when: a variety of inputs or options need to be captured, or when the user needs to review and confirm details before the action is performed.

An example can be when: First a user loads the form that contains details for a specific user, submit the changes, and review the changes and confirm.

And in such cases, websites will implement rigorous access controls over some of the steps. But still they may ignore others. Like a website where access controls are applied in the first and second step, but not on the third.

This usually happens because the website assumes that a user will only reach the 3rd step if they have completed the previous ones, but an attacker can gain access to the function by skipping them, and directly submitting the request for the third step with the required parameters.

## Lab.1 - Multi-Step Process With No Access Control on One Step

The lab has an admin panel with multi-step process to change a user's role. To familiarize you can login with `administrator:admin`. And to solve the lab use `wiener:peter` and promote yourself to become an administrator.

After I logged in as administrator, in the Admin Panel, I can upgrade users. I upgraded `carlos`, and it asked if "I'm sure to do this".

When I check the requests, when I chose to upgrade the user, the request was like this:

```http
POST /admin-roles HTTP/2
...

username=carlos&action=upgrade
```

The response to this was `200 OK` and when I clicked that I'm sure to do this, the request changed to:

```http
POST /admin-roles HTTP/2
...

action=upgrade&confirmed=true&username=carlos
```

The response now is `302 Found` and the user has been upgraded. Now, let's try to login as `Wiener` and upgrade myself to admin.

Logging in with the `Wiener` I don't have access to the admin panel, but I will try to mimic the steps of the administrator user.

If I try to access `/admin` I got `401 Unauthorized`.

Now, I will try to issue direct a `POST` request to upgrade myself, without even going to the admin panel. This by doing a request to `/admin-roles` with the body `username=wiener&action=upgrade`. Still I got a `401 Unauthorized`.

Let's add the final piece to the body `confirmed=true`, so the full body will be `action=upgrade&confirmed=true&username=wiener`.

When I send this I got a `302 Found`, which means my account got upgraded, and the lab is solved.


